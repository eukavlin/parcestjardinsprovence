<!DOCTYPE html>

<html>
<head>
    <title>Parcs et Jardins</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
    <script src="http://code.jquery.com/jquery-latest.js" type="text/javascript"></script>
    <!--<link rel="stylesheet" href="bootstrap.css" media="screen" title="no title">-->
    <link href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700,900" rel="stylesheet">
    <link rel="stylesheet" href="style.css" media="screen" title="no title">
</head>
<body>
  <header>
    <h1>Parcs et Jardins<br><span class="bold">de Provence</span></h1>
  </header>

    <div id ="myTablePlaceholder">
      <ul id = "gardensList">
        <h3>Sélectionnez un parc ou jardin</h3>
      </ul>
      <div class="gardensInfo">
        <form onsubmit="return mySubmitFunction()">
          <input id="citySearch" type="text" name="name" placeholder="Rechercher par ville provençale...">
        </form>
        <h2 id="coord"></h2>
        <p id="name"> </p>
        <p id="soustype"> </p>
        <p id="city"> </p>
        <p id="telephone"> <br><br> Les informations apparaîtront ici ...</p>
        <div id="map">

        </div>
      </div>
    </div>


    <script type="text/javascript">
      //callback method

      function AdditionalData_Loaded(data)
      {
        //create a table
        var placeholder=document.getElementById("myTablePlaceholder");
        var tel=document.getElementById("telephone");
        var city=document.getElementById("city");
        var name=document.getElementById("name");
        var gardens=document.getElementById("gardensList");
        var sstype=document.getElementById("soustype");
        var coord=document.getElementById("coord");
        var Cities = [];
        var selectCities= [];

        //for each row in the table add the cell contents
        for (var i=1; i < data.d.length; i++)
        {
            var li=document.createElement('LI');
            var citiesClass = AddDataContents(data.d, i,'ville');
            gardens.appendChild(li);
            li.appendChild(AddCellContents(data.d, i,'raisonsociale'));
            li.setAttribute("class", citiesClass);
            var inputBox = document.getElementById('citySearch').getAttribute("value");

            let listclass = li.getAttribute("class");
            console.log(inputBox);
            if (citySearch === null) {
              li.style.display = "block";
            } else if (citySearch != listclass) {
              li.style.display = "block";
            } else {
              li.style.display = "block";
            }
          };


// Tableau de toutes les villes
/*
            Cities.push(AddDataContents(data.d, i,'ville'));
            Cities.sort();

        $.each(Cities, function(i, el){
    if($.inArray(el, selectCities) === -1) selectCities.push(el);
});
for (let j=0; j < selectCities.length; j++){
  let singleCities = selectCities[j];
}*/

        $( "#gardensList" ).on( "click", "li", function() {
          let index = $(this).index();
          $(coord).html("Coordonnées");
          $(name).html(AddCellContents(data.d, index,'raisonsociale'));
          $(sstype).html(AddCellContents(data.d, index,'soustype'));
          $(tel).html(AddCellContents(data.d, index,'tlphone'));
          $(city).html(AddCellContents(data.d, index,'codepostal'));
          $(city).append(AddCellContents(data.d, index,'ville'));

      var latit = AddDataContents(data.d, index,'latitude');
      var longi = AddDataContents(data.d, index,'longitude');
      var myLatLng = {lat: parseFloat(latit), lng: parseFloat(longi)};
      // Create a map object and specify the DOM element for display.
      var map = new google.maps.Map(document.getElementById('map'), {
        center: myLatLng,
        scrollwheel: true,
        zoom: 15
      });

      var infowindow = new google.maps.InfoWindow({
        content: AddDataContents(data.d, index,'raisonsociale')
      });
      // Create a marker and set its position.
      var marker = new google.maps.Marker({
        map: map,
        position: myLatLng,
        title: AddDataContents(data.d, index,'raisonsociale')
      });
      marker.addListener('click', function() {
   infowindow.open(map, marker);
 });



        });

      }

      //add cell contents to the table
      function AddCellContents(data, cell, id)
      {
          var para=document.createElement('SPAN');
          var dataCell = data[cell][id];
          para.appendChild(document.createTextNode(dataCell));
          return para;

      }
      function AddDataContents(data, cell, id)
      {
          var dataCell = data[cell][id];
          return dataCell;

      }

      function mySubmitFunction(evt) {
        evt.preventDefault();
        someBug();
        return false;
      }

      $(document).ready(function() {
          LoadAdditionalData();
      });



    </script>
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCCxgJE0CAbJGY-duQsuvDNWdRy77_xR1U"
            async defer></script>
    <script src="app.js" charset="utf-8"></script>
</body>
</html>
